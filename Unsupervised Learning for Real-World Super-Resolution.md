## Unsupervised Learning for Real-World Super-Resolution 

非常经典的文章，真实世界超分辨率的无监督学习最经典的文章

---

#### Abstract:

先说下背景：

大多数当前的超分辨率方法依赖于低分辨率和高分辨率图像对，以有监督的方法来训练一个网络，然而现实世界应用中这样的图像对不大可能存在。 大多数已有的方法都是采用很有名的bicubic  downsampling策略来人工生成高分辨率对应的低分辨率图像。不幸的是，这种策略会引入很明显的伪影(artifacts)，从而消除了自然的传感器噪声和其他现实世界的特征。 因此，在这样的bicubic images上训练的超分辨率网络很难将其推广到自然图像。

在这项工作中，我们提出了一种无监督的图像超分辨率方法。 仅给出未配对的数据，我们将学习反转bicubic downsampling的效果，以恢复数据中存在的自然图像特征。这使我们能够生成逼真的图像对，忠实地反映现实世界图像的分布。 因此，我们的超分辨率网络可以在高分辨率域中通过direct pixel-wise supervision(直接的像素监督)进行训练，同时可以可靠地泛化到实际输入。 我们在定量和定性实验中证明了我们方法的有效性。



####  背景：

缺乏自然的低分辨率（LR）和高分辨率（HR）图像对使超分辨率方法的评估和训练大大复杂化。因此，该领域的研究长期以来一直依靠使用已知的退化算子（如bicubic kernel）来人工生成相应的LR图像[9，31，34]。 尽管这种简单明了的方法可以实现简单有效的基准测试并生成几乎无限的训练数据，但它也具有很多缺点。bicubic downsampling可以通过例如去除传感器噪声和压缩伪像来极大地改变图像的自然特性。

仅使用bicubic kernel downsampling人工下采样的图像的最新方法无法推广到自然图像。 如图1所示，即使很小的噪声也会导致仅在三次立方图像上训练的网络（在这种情况下为ESRGAN [35]）输出明显的伪像。==**As visualized in Figure 1, even small levels of noise causes a network trained only on bicubic images, in this case ESRGAN [35], to output significant artifacts. In fact, this is expected as deep learning methods are known to be sensitive to significant differences between the train and test distributions. The ESRGAN has
not seen noisy input images during train-time due to the smoothing effects introduced by bicubic downsampling.**==

在这项工作中，我们提出了一种训练通用方法的新颖方法，以克服现实世界中SR的挑战。 我们通过学习相应的逆映射操作来解决由bicubic downsampling引起的training和testing distribution之间的shift(转换)。 为此，我们训练了从bicubic图像到现实世界LR图像分布的映射。 通过采用循环一致性损失[40]，我们以完全不受监督的方式学习了这种映射。 将学习到的网络应用于bicubic downsampling后的图像，以生成遵循真实世界分布的成对的LR和HR图像。 这使我们能够在不受bicubic shift影响的现实数据集上学习SR网络。 此外，SR网络在HR域中通过直接的像素监督进行训练，而无需任何成对的真实数据。 我们的方法对自然图像的视觉结果如图1所示。

由于没有配对数据，我们在模拟自然退化的基础上，引入了一种基准测试现实世界中SR方法的协议。 我们在两种情况下分析我们的方法，即Domain Super Resolution（DSR）和Clean Super Resolution（CSR）。 在前一种情况下，实际数据分布是由一组自然图像定义的。但是，我们的方法推广到了SR网络的输入和输出分布不同的情况。 因此，我们引入了CSR任务，其目标是获得清晰的超分辨率图像，该图像由高质量图像的separate output distribution of high quality images(单独输出分布)定义。 我们在上述基准上论证了我们的方法的有效性，并将其与基准方法和最新方法进行了比较。 最后，我们显示了在DPED [17]数据集上对超现实世界的智能手机图像进行超分辨的任务的定性结果。

#### Related Work:

直到最近，单图像超分辨率（SISR）方法仍主要以PSNR为基准，用于超分辨双三次降采样图像。 传统上是用经典技术[19、12、29、36、15]解决的，而当前的方法[9、10、22、23、26、11、2、3、14、16]则采用深度学习方法来训练从LR到HR的映射。 在后者中，EDSR [26]特别引入了ResNet启发的体系结构，该体系结构更适合手头的任务。 但是，为了训练网络，这些方法依赖于L1或L2 Loss。

尽管这些Loss与PSNR评估指标密切相关，但它们并未保留自然的图像特性，通常会导致结果模糊[38]。 为了解决这个问题，Ledig等人。  SRGAN[24]引入了一种目标函数，目的是在视觉上获得更令人满意的结果。 新的目标是GAN鉴别器和在VGG特征空间中计算的损失。 与现有技术相比，PSNR较差，但超分辨图像的感知质量显着提高。 遵循这一理念，PIRM2018 [18]挑战赛的新赢家ESRGAN [35]提出了进一步的架构改进，以进一步提高感知质量。尽管取得了成功，但上述方法由于依赖于三次三次下采样操作来训练数据生成而受到严重限制。 此操作消除了大多数高频分量，因此大大改变了自然图像特性，例如噪声，压缩伪像和其他失真。

因此，bicubic downsampling假设很少反映现实世界的情况。 Blind SR通过假设LR和HR image pairs具有unknown degradation和downsampling kernels来做SR， 而非一直大家做的基于图像对，其中低分辨率图像是从高分辨率图像做bicubic downsampling操作获得的这种比较简单的single image super resolution。 对该问题的早期尝试[4]包括显式估计未知点扩展函数本身[28，13]。 研究的另一个方向旨在通过执行特定于图像的SR来完全消除对外部训练数据的需求。 遵循这个想法，ZSSR [30]通过执行广泛的数据扩充，仅使用测试图像本身来训练轻量级网络。 但是，该方法仍采用固定下采样操作在测试时生成合成对。此外，特定于图像的学习导致极慢的预测。



最近的一些工作解决了无监督的SR设置，其中没有给出成对的LR-HR对，并且LR和HR图像之间的关系未知。 Cycle-in-Cycle[37]使用采用循环一致性损失的框架，学习了从原始输入图像到干净图像空间的映射。 除了通常的perceptual GAN-discriminator之外，仅通过在LR域中使用indirect supervision(间接监督)来训练SR网络本身。 相反，我们的框架允许在HR domain进行direct supervison，从而可以更好地培训SR网络本身。

此外，我们不是在训练和测试期间“clean”输入图像，而是学习a mapping to the original input domain for only the training。 另一个工作集中在下采样过程[21]，以提高SR。但是，仅在具有学习到的降采样操作的图像上执行SR，因此SR不适用于我们的实际场景。 也Bulat等。  [5]专注于学习下采样过程的问题。 但是，此方法专门解决了超分辨人脸的问题，在该问题中，网络可以了解到强大的内容先验。 相反，我们解决了一般的SR问题，而不对图像内容进行任何假设。

最后，最近的工作[39，7，6]提出了捕获真实LR-HR图像对的策略。 但是，这些方法依赖于复杂的数据收集过程，需要专用的硬件，难以规模化且规模庞大。 



#### 提出的方法：

在这里，我们可视化了bicubic downsampling的效果，并将其与我们的domain distribution learning进行了比较。 原始HR图像包含明显的传感器噪声，在bicubic downsampling后几乎完全消失。 与将原始HR图像的裁切图像(具有和经过bicubic downsampling同样的分辨率)相比，可以清楚地观察到这一点。 我们学习到的映射G恢复了原始HR图像中存在的图像特征（右）。

由于现实世界超分辨率问题缺乏用于评估和训练的自然LR和HR图像对。 因此，为了人工生成对应的LR图像对，SR的研究长期依赖于使用已知的降尺度运算符（例如bicubic）。双三次下采样可以通过例如消除传感器噪声和压缩伪像来极大地改变图像的自然特性。因此很有局限性。

以下就是公式来描述和如何用GAN来推导：

---

$X$:  low resolution image, but is natural real-world  image, not artifically generated by high-resolution images

$Y$: High Resolution Image, 可能是和X配对的高分辨率图像，也可能是不和X配对的高分辨率图像，但不管设么情况，必须是高分辨率图像。

$\hat{Y} = S(X)$:  S是一个非线性映射，可以将低分辨率图像映射到高分辨率图像，当然最理想情况肯定是高分辨率图像和输出的超分辨率图像一抹一样。 即$\hat{Y} = Y$



* Classic SR: 成对数据，有高分辨率，也有相对应的经过bicubic downsampling得到的低分辨率图像，然后进行有监督的训练。即$Z=B(Y)$，其中$B$是bicubic downsampling，目标就是学习一个non-linear mapping $S$，使得$S(Z)\approx Y$ 。 注意： 对于classic SR，没有上面写到的$X$，因为X是low-resolution natural real-world image，而我们的classic SR，低分辨率图像是$Z$。但是问题就是bicubic downsampling会极大的改变图像的自然特征，比如移除了sensor noise和compression artifacts。因此经过bicubic downsampling后得到的$Z$的分布和真实世界和高分辨率Y相对应的低分辨率的X分布不相同。
* Blind SR: 成对数据，有高分辨率，也有相对应的低分辨率图像（一定是相对应的低分辨率图像）。即也为一个supervised learning，但不同的地方是（个人感觉），高分辨图和对应的低分辨率图像是已有的，即是given，而不是像classic SR一样经过bicubic downsampling获得的。但是问题就是对于盲超分，我们假定的是对应的低分辨率图像不是经过bicubic downsampling获得的，而是经过fixed and transformation which is unknown. 比如$X = f_{deg}(k*Y) + n$， 其中$k$为unknown kernel, $* $ is convolution operation, $f_{deg}$为degradation transformation, 可能是bicubic downsampling, 也可能是更复杂的非线性变换。盲超分就是学习这几个未知的函数， kernel ,noise distribution, degradation transformation。
* Real World SR: 不成对数据，但也都是available, 即$X$,$Y$均可观测。X是natural real-world Image。 比如$X$是64* 64*3的低分辨率图像，是用相机获得的。 $Y$也是用相机获得的，是128 * 128 *3的高分辨率图像，且$X$和$Y$不是成对的，没有对应关系。 Real World SR的目标就是找到一个$X$到$Y$的映射。



作者的做法是：

首先将$Y$做人工的bicubic downsampling操作，变成$Z$，即$Z=B(Y)$, 然后训练一个生成器$G$, 使得$G(Z)$即$G(B(Y))$为real world低分辨率图像。换句话说，从现实世界真实的高分辨率图像，经过人工bicubic downsampling 即B操作变成低分辨率图像后，再经过一个生成器G映射，让映射后的样本可以服从现实世界真实的低分辨率图像的分布。 这样，最终可以获得图像对$(G(B(Y)), Y)$。 因此就可以用有监督学习方式来学习一个SR网络或者说一个复杂的非线性映射$S$，使得$S(G(B(Y))) \approx Y$，并且作者指出==the main advantage of this approach is the SR network can be trained with direct pixel-wise supervision in the HR domain.==



==示意图等会画出来==



首先训练一个G, called the domain distribution network, in a conditional gan setting。 然后用一个判别器来判别$\hat{X}=G(B(Y))$ 和$X$之间的区别。 即我们希望我们的生成器可以将合成的$\hat{X}$和现实世界真实的低分辨率图像$X$相同。

















































我们提出了一种评估现实世界中SR方法的新颖策略。 在传统的SR中，对三次三次降采样的图像Z = B（Y）进行超分辨，并将其与Y进行比较。 在现实世界中，我们无法获取地面图像，从而使定量分析变得更加复杂。 另一方面，我们可以通过对数据集应用降尺度和综合降级来构造输入{Xi} M i = 1〜pX和输出{Yj} N j = 1〜pY训练图像的集合，从而紧密模拟现实世界的场景 原始图像。
   降级的类型对于SR方法是未知的。
   为了进行评估，我们进一步生成了一组地面真实对（X〜i，Y〜i），其中X〜i〜pX和Y〜i〜pY。 在培训过程中，这些是网络无法访问的，仅用于评估目的。 我们考虑两种情况：DSR和CSR，下面将详细介绍。
   特定于领域的超分辨率（DSR）输入的X和目标Y图像共享相同的实际分布，即pX = pY。 因此，目的是产生与其输入图像具有相同分布的超分辨图像Y 1。 通过首先对图像进行下采样，然后模拟现实世界中的降级来生成训练集。 在DSR情况下，相同的训练集{Xi} M i = 1表示输入pX和输出pY分布。 为了评估，使用与训练图像Xi相同的过程来构造输入图像Xi。 通过将劣化直接加到原始HR图像上来获得对应的地面真实输出图像Yi。 该过程如图4所示。